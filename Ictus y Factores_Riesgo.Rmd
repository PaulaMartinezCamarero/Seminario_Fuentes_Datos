---
title: "Ictus y Factores_Riesgo"
author: "Andrés Estévez, Paula Martínez"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



#Introducción
En nuestro seminario vamos a estudiar las altas hospitalarias por ictus, en los diferentes hospitales de Castilla y León durante cuatro años, y como estas, están relacionadas con distintos factores de riesgo.

Lo primero de todo, explicar que los factor de riesgo son características o circunstancias que atentan contra el equilibrio, contra la salud, y que causan enfermedades o muerte. [senado1999factores]

Durante el desarrollo de nuestro seminario vamos a trabajar con datos de dos factores de riesgo, los cuales son: un estilo de vida sedentario y la exposición al humo. Además, vamos a relacionar también el ictus con la calidad del aire.

El ser sedentario es un factor de riesgo del ictus, ya que "existe una significativa relación inversa entre actividad física y riesgo de ictus..., tanto en varones como en mujeres" [martinez2000factores]

Otro factor de riesgo del ictus es la exposición al humo, ya que "los fumaodres pasivos también tienen un mayor riesgo de ictus, puesto que la exposición al humo del cigarrillo aumenta el riesgo de progresión de aterosclerosis." [martinez2000factores]

La calidad del aire es otro factor de riesgo del ictus, quizás menos conocido, pero estudios confirman que "Niveles más elevados de NO el día de ingreso conlleva un aumento del riesgo de mortalidad" [suarez2024influencia]


#Objetivos

**Objetivos principales:**
1.Estudiar la cantidad de altas hospitalarias por ictus que hay en cada provincia de Castilla y León y ver como varían dependiendo del sexo y de la edad.
2.Analizar como el sedentarismo influye dependiendo de la edad en el riesgo de sufrir un ictus.
3.Estudiar la relación de estar expuesto al humo con la probabilidad de sufrir un ictus. Además, vamos a ver si hay más número de centros de ayuda para desintoxicación, en las provincias en las que más ictus haya habido.
4.Analizar si a peor calidad del aire hay más riesgo de sufrir un ictus.


#Procedencia y Descripción  de datos

Los datos han sido recabados de [Datos abiertos del gobierno de españa](https://datos.gob.es/es/) que hasta el momento contiene cerca de 90000 conjuntos de datos, distribuidos en un amplio número de temáticas.También supera las 550000 distribuciones, Además de 313 iniciativas de datos abiertos.


#Descripción y Importación de datos
**Descripción**
Contamos con 3 sets de datos en tipo *.csv*.
Este formato, **(Comma Separated Values)** son archivos de texto que en pricipio deberían estar con los caracteres separados por comas, aunque en algunos de nuestros datos se usa punto y coma en lugar de la coma.

Estos son nuestros archivos *.csv*.:
  -[calidad_aire](https://servicios.jcyl.es/esco/cargarFrmDatosHistoricos.action)
  -[sedentarismo](https://datos.gob.es/es/catalogo/ea0010587-sedentarismo-segun-sexo-y-grupo-de-edad-poblacion-de-15-y-mas-anos-identificador-api-t15-p420-a2019-p06-l0-04006-px1)
  -[exposicion_humo](https://datos.gob.es/es/catalogo/ea0010587-exposicion-al-humo-de-tabaco-en-lugares-cerrados-segun-sexo-pais-de-nacimiento-y-grupo-de-edad-poblacion-de-15-y-mas-anos-identificador-api-t15-p420-a2019-p03-l0-02026-px1)
  
También contamos con dos sets de datos *.json*.**(JavaScript Object Notation)** es un formato para almacenar e intercambiar datos.

Estos son nuestros archivos *.json*.:
  -[altas_hospitalarias_ictus](https://datos.gob.es/es/catalogo/a07002862-altas-hospitalarias-con-diagnostico-de-ictus)
  -[centros_servicios_saisde](https://servicios.ine.es/wstempus/jsCache/es/DATOS_TABLA/65334?tip=AM&)
Este último proviene del **Instituto Nacional de Estadística (INE)**.



  
#Manipulación de datos

#Importación de datos

#Importamos los datos de las altas hospitalarias por ictus
```{r}
library(readr)
altas_hospitalarias_ictus <- read_delim("INPUT/data/altas_hospitalarias_ictus.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
#View(altas_hospitalarias_ictus)

```

```{r}
library(rjson)
altas_hospitalarias_ictus <- fromJSON(file="INPUT/data/altas_hospitalarias_ictus.json")

altas_hospitalarias_ictus %>%
  spread_all() %>%

  #View()
```
#Ictus, edad y sexo
-Para resolver el primer objetivo vamos a:
  - 1 Obtener las edades de todos los pacientes para ver si la edad es un factor                 determinante en el aumento de los ictus.
```{r}
altas_hospitalarias_ictus %>%
  spread_all() %>%
  gather_object %>%
  json_types %>%
  count(name, type)

```

```{r}
altas_hospitalarias_ictus %>%
  enter_object(fields) %>%
  gather_object %>%
  spread_all %>%
  json_types%>%
  count(name, type)
```


```{r}
library(tidyverse)
library(rjson)
library(tidyjson)

edades_total <- altas_hospitalarias_ictus %>%
  spread_all %>%               
  enter_object("fields") %>%     
  spread_all() %>% 
  #con gather_object nos muestra 220,888 resultados
  rename(Edad = edad) %>%         
  select(Edad)

```
 
 
 
```{r}
#edades_total$Edad
source("INPUT/functions/total_por_edad.R")
resultados <- total_por_edad(edades_total)
print(resultados)

```
```{r}
regresion_edad_ictus <- lm(Conteo~Edad,data=resultados)
summary(regresion_edad_ictus)
```
```{r}
ggplot(data=resultados, aes(x=Edad,y=Conteo))+
  geom_point()+
  geom_smooth()
```

```{r}
cont_mujeres <- 0
cont_hombres <- 0
for(i in altas_hospitalarias_ictus$Sexo){
  if(i=="Mujer"){
    cont_mujeres <- cont_mujeres+1
  }else if(i=="Hombre"){
    cont_hombres <- cont_hombres+1
  }
}
cat("hay un total de ", cont_mujeres, "mujeres y ", cont_hombres, "hombres\n")
```

  - 2 Obtener el numero de hombres y mujeres para ver si el sexo influye en la cantidad de        ictus


  - 3 Juntar la edad con el sexo para ver la influencia de ambos factores en los ictus
  
Grupos de mujeres segun las edades
```{r}

m_0_18 <- 0
m_19_35 <- 0
m_36_50 <- 0
m_51_65 <- 0
m_mas_66 <- 0

for(i in 1:nrow(altas_hospitalarias_ictus)){
  if(altas_hospitalarias_ictus$Sexo[i] == "Mujer"){
    e <- altas_hospitalarias_ictus$Edad[i]
    if(e < 18){
      m_0_18 <- m_0_18 + 1
    } else if(e >= 19 && e <= 35){
      m_19_35 <- m_19_35 + 1
    } else if(e >= 36 && e <= 50){
      m_36_50 <- m_36_50 + 1
    } else if(e >= 51 && e <= 65){
      m_51_65 <- m_51_65 + 1
    } else if(e >= 66){
      m_mas_66 <- m_mas_66 + 1
    }
  }
}

cat("Hay ", m_0_18, " mujeres de entre 0 y 18 años\n")
cat("Hay ", m_19_35, " mujeres de entre 19 y 35 años\n")
cat("Hay ", m_36_50, " mujeres de entre 36 y 50 años\n")
cat("Hay ", m_51_65, " mujeres de entre 51 y 65 años\n")
cat("Hay ", m_mas_66, " mujeres de más de 66 años\n")
```

Grupos de hombres segun las edades

```{r}
h_0_18 <- 0
h_19_35 <- 0
h_36_50 <- 0
h_51_65 <- 0
h_mas_66 <- 0

for(i in 1:nrow(altas_hospitalarias_ictus)){
  if(altas_hospitalarias_ictus$Sexo[i] == "Hombre"){
    e <- altas_hospitalarias_ictus$Edad[i]
    if(e < 18){
      h_0_18 <- h_0_18 + 1
    } else if(e >= 19 && e <= 35){
      h_19_35 <- h_19_35 + 1
    } else if(e >= 36 && e <= 50){
      h_36_50 <- h_36_50 + 1
    } else if(e >= 51 && e <= 65){
      h_51_65 <- h_51_65 + 1
    } else if(e >= 66){
      h_mas_66 <- h_mas_66 + 1
    }
  }
}

cat("Hay ", h_0_18, " hombres de entre 0 y 18 años\n")
cat("Hay ", h_19_35, " hombres de entre 19 y 35 años\n")
cat("Hay ", h_36_50, " hombres de entre 36 y 50 años\n")
cat("Hay ", h_51_65, " hombres de entre 51 y 65 años\n")
cat("Hay ", h_mas_66, " hombres de más de 66 años\n")
```

  
```{r}
library(dplyr)
t2 <- tibble(
  Sexo = rep(c("Hombres", "Mujeres"), each = 5),
  Edad = rep(c("0-18", "19-35", "36-50", "51-65", "66+"), times = 2),
  Poblacion = c(h_0_18, h_19_35, h_36_50, h_51_65, h_mas_66, 
                m_0_18, m_19_35, m_36_50, m_51_65, m_mas_66)
)
```
```{r}

library(ggplot2)
library(tidyverse)

ggplot(data = t2, aes(x = Edad, y = Poblacion,fill=Sexo)) + 
  geom_bar( stat = "identity", position = "dodge",colour = "black") +
  labs(title = "Distribución de Población por Sexo y Edad",
       x = "Grupos de Edad", y = "Población") +
  theme_minimal()
```



  - 4 Obtener el numero de casos por provincias para empezar a relacionarlo con los            siguientes objetivos


#Importamos los datos de la calidad del aire
```{r}
library(readr)
calidad_aire <- read_csv("INPUT/data/calidad_aire.csv")
#View(calidad_aire)
```

#Importamos los datos de sedentarismo

```{r} 

library(readr)
sedentarismo <- read_delim("INPUT/data/sedentarismo.csv", 
    delim = ";", escape_double = FALSE, na = "No consta", 
    trim_ws = TRUE)
#View(sedentarismo)
```


#Importamos los datos exposición al humo
```{r}
library(readr)
exposicion_humo <- read_delim("INPUT/data/exposicion_humo.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
#View(exposicion_humo)
```

#Importamos los datos de los centros de desintoxicación
```{r}
library(readr)
centros_servicios_saisde <- read_delim("INPUT/data/centros_servicios_saisde.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)
#View(centros_servicios_saisde)
```
```{r}
library(tidyverse)
library(rjson)
centros_servicios_saisde <- fromJSON(file = "INPUT/data/centros_servicios_saisde.json")
centros_servicios_saisde
head(centros_servicios_saisde)
library(tidyjson)
centros_servicios_saisde %>%
  spread_all() %>%
  count(provincia = fields.provincia)


  #View() ya tenemos los datos que queremos asiq no nos metemos mas adentro
  
```




Probamos a hacer las linea 854 y 861 luego










#Importamos función que imprime los habitantes de castilla y león por provincias
```{r}
source("INPUT/functions/poblacion_cyl.R")

```









#Ictus y sedentarismo

#Ictus y exposición al humo

#Ictus y calidad del aire

#Conclusiones


